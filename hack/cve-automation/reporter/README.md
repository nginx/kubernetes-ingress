# reporter Package

This package handles SARIF (Static Analysis Results Interchange Format) file parsing and markdown report generation for CVE vulnerabilities.

## Files

### sarif.go

Contains all SARIF parsing logic and vulnerability deduplication:

**Types:**

- `Report`, `Run`, `Tool`, `Driver`, `Rule`, `Help`, `ResultProperties` - SARIF JSON structure
- `UniqueVulnerability` - Deduplicated vulnerability with source tracking

**Functions:**

- `ParseSarifFiles(paths map[string]struct{})` - Parses multiple SARIF files and deduplicates vulnerabilities
- `parseSarifFile(sarifFile string)` - Parses a single SARIF file
- `severityGate(severities []string)` - Filters for HIGH and CRITICAL severities
- `sarifFilePathToFeatures(name string)` - Extracts architecture/feature info from filename
- `exactlyOne(bs ...bool)` - Bitwise trick to check if exactly one boolean is true

**Feature Detection:**
Extracts image metadata from filenames:

- Architectures: ubi, ubi8, debian, alpine
- Features: nap, nap-v5, dos, plus, fips

### render.go

Handles markdown report generation from parsed vulnerabilities:

**Functions:**

- `RenderMarkdown(vulnerabilities, baseDirectory)` - Generates timestamped markdown report
- `templateFuncs()` - Provides custom template functions for deduplication

**Template Functions:**

- `joinStrings` - Joins string arrays
- `uniqueNumericalSeverities` - Deduplicates CVSS scores across images
- `uniqueTextSeverities` - Deduplicates severity tags across images

**Output:**

- Reports written to `{baseDirectory}/reports/cve-report-YYYY-MM-DD.md`
- Uses template from `{baseDirectory}/templates/cve-report.md.tmpl`

## Usage

```go
import "github.com/nginx/kubernetes-ingress/hack/cve-automation/reporter"

// Parse SARIF files
selectedFiles := map[string]struct{}{
    "/path/to/alpine.sarif.json": {},
    "/path/to/debian.sarif.json": {},
}

vulns, err := reporter.ParseSarifFiles(selectedFiles)
if err != nil {
    // handle error
}

// Generate markdown report
reportPath, err := reporter.RenderMarkdown(vulns, "/project/root")
if err != nil {
    // handle error
}
```

## Key Features

- **Vulnerability Deduplication**: Tracks same CVE across multiple images
- **Severity Filtering**: Only includes HIGH and CRITICAL vulnerabilities
- **Multi-source Tracking**: Maintains which images contain each vulnerability
- **Feature Extraction**: Intelligently parses image names for architecture/features
- **Template-based Rendering**: Flexible markdown generation via Go templates
