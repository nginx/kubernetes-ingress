# dockerscan Package

This package implements the Docker image scanning workflow using Bubble Tea TUI framework.

## File Structure

### Core Files

- **model.go** - Contains the main `Model` struct, state enums, and initialization logic
  - `Model`: The Bubble Tea model that manages the entire workflow state
  - `dockerStep`: Enum for workflow steps (select images, confirm, generate, etc.)
  - `imageStatus`: Enum for tracking image scan status (pending, in progress, done)
  - `InitialModel()`: Creates and initializes a new Model

- **update.go** - Handles all state updates and message processing
  - `Update()`: Main update function that processes all messages
  - Handles keyboard input, progress updates, window resizing, etc.

- **view.go** - Renders the UI for different workflow steps
  - `View()`: Main view function that renders based on current state
  - `renderConfirmation()`: Renders the yes/no confirmation screen
  - `renderProgress()`: Renders SARIF generation progress with progress bar and spinners
  - `renderCleanupConfirmation()`: Renders the keep/delete temp directory screen

### Data Types

- **docker_images.go** - Docker image related types and functions
  - `dockerImage`: Implements `list.Item` interface for Docker images
  - `getDockerImages()`: Fetches Docker images from the Docker API
  - `getImagesWithFilter()`: Fetches images matching a specific filter
  - `humanSizeBinary()`: Formats file sizes in human-readable format

- **sarif_files.go** - SARIF file related types and functions
  - `sarifFile`: Implements `list.Item` interface for SARIF files
  - `loadSarifFilesList()`: Loads SARIF files from the output directory

### UI Components

- **delegate.go** - Custom list delegate for rendering selectable items
  - `selectDelegate`: Custom delegate that shows checkmarks and cursors
  - Handles both `dockerImage` and `sarifFile` types
  - `Render()`: Renders items with selection indicators

### Commands

- **commands.go** - Bubble Tea commands for async operations
  - `generateSarifFiles()`: Runs docker scout in parallel for selected images
  - `parseAndRenderReport()`: Parses SARIF files and generates markdown report using the reporter package
  - Message types: `sarifProgressMsg`, `sarifGenerationCompleteMsg`, `parseCompleteMsg`

## Dependencies

This package depends on the `reporter` package for SARIF parsing and markdown generation:

- `reporter.ParseSarifFiles()` - Parses SARIF files and returns vulnerabilities
- `reporter.RenderMarkdown()` - Generates markdown report from vulnerabilities

## Workflow Steps

1. **StepSelectImages** - User selects Docker images from a list
2. **StepConfirmSelection** - User confirms whether to generate SARIF files
3. **StepGenerateSarifs** - Parallel generation of SARIF files with progress tracking
4. **StepSelectSarifFiles** - User selects which SARIF files to include in report
5. **StepParseAndRender** - Parse selected SARIF files and generate markdown report
6. **StepAskCleanup** - User decides whether to keep or delete temp directory
7. **StepComplete** - Show final results and exit

## Key Features

- **Parallel SARIF Generation**: Uses goroutines to scan multiple Docker images simultaneously
- **Real-time Progress**: Progress bar and animated spinners show scan progress
- **Styled UI**: Uses lipgloss for button styling and consistent UI
- **Multi-select Lists**: Reusable list component for both images and SARIF files
- **Error Handling**: Comprehensive error handling at each step
- **Clean Architecture**: Separated concerns with dedicated reporter package
