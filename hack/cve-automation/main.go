package main

import (
	"fmt"
	"log"
	"os"
)

func main() {
	fmt.Println("Welcome to generating automated CVE reports!")

	token, err := getGitHubToken()
	if err != nil {
		log.Fatalf("Error getting GitHub token: %v", err)
	}

	githubArtifacts, err := getGitHubArtifactURLs(token, "main")
	if err != nil {
		log.Fatalf("Error getting GitHub artifacts: %v", err)
	}

	for _, art := range githubArtifacts {
		fmt.Printf("Artifact: %s\n", art)
	}

	dockerImages, err := getDockerImages()
	if err != nil {
		log.Fatalf("Error getting Docker images: %v", err)
	}

	for _, img := range dockerImages {
		fmt.Printf("Image: %s\n", img)
	}

	// Create a new client that handles common environment variables
	// for configuration (DOCKER_HOST, DOCKER_API_VERSION), and does
	// API-version negotiation to allow downgrading the API version
	// when connecting with an older daemon version.

	model, err := initialModel()
	if err != nil {
		log.Fatalf("Error initializing model: %v", err)
	}

	fmt.Printf("Model: %s\n", model)

	os.Exit(0)
}

// humanSizeBinary converts a byte count to a human-readable IEC (base-1024) size.
// Examples: 0 -> "0 B", 1024 -> "1.00 KiB", 154333620 -> "147.19 MiB".
func humanSizeBinary(b int64) string {
	if b == 0 {
		return "0 B"
	}

	neg := b < 0
	if neg {
		b = -b
	}

	units := []string{"B", "KiB", "MiB", "GiB", "TiB", "PiB", "EiB"}
	v := float64(b)
	u := 0

	for v >= 1024 && u < len(units)-1 {
		v /= 1024
		u++
	}

	if u == 0 {
		if neg {
			return fmt.Sprintf("-%d %s", b, units[u])
		}
		return fmt.Sprintf("%d %s", b, units[u])
	}

	if neg {
		return fmt.Sprintf("-%.2f %s", v, units[u])
	}
	return fmt.Sprintf("%.2f %s", v, units[u])
}
