package main

import (
	"context"
	"fmt"

	"github.com/moby/moby/client"
)

func getDockerImages() (images []string, err error) {
	apiClient, err := client.New(client.FromEnv)
	if err != nil {
		panic(err)
	}
	defer func() {
		err = apiClient.Close()
		if err != nil {
			err = fmt.Errorf("closing docker api client: %w", err)
		}
	}()

	// list images
	result, err := apiClient.ImageList(context.Background(), client.ImageListOptions{
		All: true,
		Filters: map[string]map[string]bool{
			"reference": {
				"nginx/*": true,
			},
		},
	})
	if err != nil {
		return nil, fmt.Errorf("unable to list images: %w", err)
	}

	items := make([]string, len(result.Items))

	// Print each container's ID, status and the image it was created from.
	fmt.Printf("%s  %-22s  %s\n", "ID", "TAGS", "SIZE")
	for i, ctr := range result.Items {
		items[i] = fmt.Sprintf("%s  %v  %s\n", ctr.ID, ctr.RepoTags, humanSizeBinary(ctr.Size))
	}

	return items, nil
}
